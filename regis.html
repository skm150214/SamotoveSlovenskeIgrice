<!DOCTYPE html>
<html lang="sl">
<head>
	<meta charset="UTF-8">
	<title>Samotova Login AAAAAAAAAAAAAAAAA če to pozabim spremenit bo wololo</title>
	<script src="./logo.js" defer></script>
	<script src="https://accounts.google.com/gsi/client" async defer></script>
	<script defer>
/*



// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBZwwpfwoWPtHkMQMak55RSqxbrJFm46t8",
  authDomain: "samotovesisifbdb.firebaseapp.com",
  projectId: "samotovesisifbdb",
  storageBucket: "samotovesisifbdb.firebasestorage.app",
  messagingSenderId: "20983452290",
  appId: "1:20983452290:web:605665c5960aaaf9221a9b",
  measurementId: "G-B91EM50NYZ"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);*/




// Helper funkcije za delo s piškotki
function setCookie(name, value, days = 180) {
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  const expires = "expires="+ d.toUTCString();
  document.cookie = name + "=" + encodeURIComponent(value) + ";" + expires + ";path=/;SameSite=Lax";
}

function getCookie(name) {
  const cname = name + "=";
  const decodedCookie = decodeURIComponent(document.cookie);
  const ca = decodedCookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i].trim();
    if (c.indexOf(cname) == 0) {
      return c.substring(cname.length, c.length);
    }
  }
  return "";
}
function eraseCookie(name) {
  document.cookie = name + '=; Max-Age=-99999999; path=/;';
}

// Spremenjene funkcije za prijavo in registracijo:
var data = null;
var isnameallow = false;
let 	GUIEW124H6G71234AU6345712456SČGwdČUGAS1264Ćfhbhćer124 = false;
  function parseJwt(token) {
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  const jsonPayload = decodeURIComponent(
	atob(base64).split('').map(function (c) {
	  return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
	}).join('')
  );
  return JSON.parse(jsonPayload);
}
function checkName(nam){
	document.getElementById("warnin").style.display = "none";
	  fetch("https://samotovesi.si/check_name.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name: nam })
  })
  .then(res => res.json())
  .then(data => {
    if (data.exists) {
      isnameallow = false;
	  document.getElementById("warnin").style.display = "block";
    } else {
      isnameallow = true;
	  	  document.getElementById("warnin").style.display = "none";
    }
  })
  .catch(err => {
    console.error("Napaka pri preverjanju imena:", err);
  });

}
function handleCredentialResponse(response) {
  data = parseJwt(response.credential); // Razšifriraj Google token
  console.log("Logged in as:", data.name);
  nameEeEe = data.name;
  console.log("Ime:", nameEeEe);
  console.log(document.getElementById("nameParam").textContent );
  console.log(nameEeEe.slice(0, Math.min(nameEeEe.length,30)));
	//document.getElementById("nameParamLabel").innerText = (data.name).slice(0, 30);
  // Shrani Google podatke v localStorage

  // Posodobi UI
  fetch("https://samotovesi.si/exist_check.php", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ sub: data.sub })
})
.then(res => res.json())
.then(data => {
  document.getElementById("cardcont").style.pointerEvents = "auto";
  document.getElementById("loginitems").classList.remove("wip");
  document.getElementById("regisitems").classList.remove("wip");
  document.getElementById("logintip").style.display = "none";
  document.getElementById("registertip").style.display = "none";
  document.getElementById("hepithingies").style.display = "block";
  document.getElementById("googlethingies").style.display = "none";
  if (data.exists) {
	document.getElementById("register").style.display = "none";
	GUIEW124H6G71234AU6345712456SČGwdČUGAS1264Ćfhbhćer124 = true;
  } else {
    console.log("Google račun še NI registriran.");
	document.getElementById("login").style.display = "none";

	document.getElementById("nameParam").value = nameEeEe.slice(0, Math.min(nameEeEe.length,30));
	checkName(document.getElementById("nameParam").value);
  }
})
.catch(err => console.error("Napaka:", err));

}


function loogin(){
  //console.log("Rezultat prijave:", result);
  // Shrani podatke v piškotke namesto localStorage
  //window.location.href = "index.html"; // Preusmeri na glavno stran
}
function spremeniStevilke(w){return (w*3)-2;}
function relength(w){
	if (w.length > 9) w = w.slice(1, 10);
	return ("0".repeat((9-w.length))) + w;
}
function dodatNameThing() {
  checkName(document.getElementById("nameParam").value);
  if (!isnameallow){
    console.warn("nepravino ime");
    return;
  }
  fetch('https://samotovesi.si/save_user.php', {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: document.getElementById("nameParam").value,
      sub: data.sub,
	  hash: btoa(spremeniStevilke((new Date().getTime()))) +  relength(spremeniStevilke(Math.floor(Math.random()*999999999)).toString()),
      badges: []
    })
  })
  .then(res => res.json())
  .then(result => {
    if (result.success != "created") {
      console.log("Rezultat prijave:", result);
      setCookie("uid", result.uid);
      setCookie("user", JSON.stringify(data));
	  setCookie("hash", result.hash);//relength("123333334342345") is ts finna work??
      setCookie("name", document.getElementById("nameParam").value);
      window.location.href = "index.html"; //https://www.youtube.com/shorts/znFMh1UwbyQ
    }
  })
  .catch(err => console.error("Napaka:", err));
}

// V DOMContentLoaded zamenjaj pridobivanje iz localStorage na branje piškotkov

document.addEventListener("DOMContentLoaded", () => {
  // Preberi user iz piškotkov
  const userCookie = getCookie("user");
  const user = userCookie ? JSON.parse(userCookie) : null;

  if (user) {
    // Prikaži gumb za logout, skrij Google login gumb
    document.getElementById('logoutBtn').style.display = 'inline-block';
    const loginBtn = document.querySelector('.g_id_signin');
    if (loginBtn) loginBtn.style.display = 'none';
  }

  // logout dogodek - če želiš dodati, npr.
  /*
  const logoutBtn = document.getElementById('logoutBtn');
  logoutBtn.addEventListener("click", () => {
    eraseCookie("user");
    eraseCookie("uid");
    eraseCookie("name");
    google.accounts.id.disableAutoSelect();
    location.reload();
  });
  */

  document.getElementById("nameParam").addEventListener("blur", function() {
    console.log("Uporabnik je končal z vnosom.");
    checkName(document.getElementById("nameParam").value);
  });
});
</script>
	<style>
		/*:root{
            --bg: oklch(93.873% 0.01594 82.743);
            --fg: oklch(87.04% 0.07572 78.315);
			--dbg: oklch(89.595% 0.02146 85.929);
			--dfg: oklch(74.013% 0.13633 73.436);
            --border: oklch(82.032% 0.00009 271.152);
            --text: oklch(25.273% 0.02809 266.461);
            --link: oklch(35.836% 0.11305 264.085);
            --btn1: oklch(57.247% 0.19855 26.15);
            --btn2: oklch(69.033% 0.14478 60.355);
            --btn3: oklch(85.899% 0.17982 111.742);
            --btn4: oklch(67.311% 0.16242 144.231);
            --btn5: oklch(64.847% 0.12907 247.976);
            --btn6: oklch(62.149% 0.2309 320.65);
			--hre: oklch(33.984% 0.00419 16.857);
			--v1: 0.596rem;
			--v2: 1.191rem;
			--vn1: -0.596rem;
			--vn2: -1.191rem;
        }*/
		@property --gradient-angle {
			syntax: "<angle>";
			initial-value: 0deg;
			inherits: false;
		}

		.gumb{

			align-items: center;
			background-color: #4caf50;
			border: none;
			color: white;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			cursor: pointer;
			border-radius: 8px;
			font-family: "ComicSansCustom", cursive;
			transition: all 0.1s cubic-bezier(0.39, 0.575, 0.565, 1);
		}
		.gumb:hover{
			scale: 1.1;
			filter:contrast(1.2);
		}
		.input{
			cursor: pointer;
			border-radius: 8px;
			font-family: "ComicSansCustom", cursive;
			transition: all 0.1s cubic-bezier(0.39, 0.575, 0.565, 1);
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			padding: 15px 32px;
			margin-left: auto;
			align-items: right;
			background-color: var(--btn5);
			border: none;
			margin: var(--v1);
			outline: black solid 0.2rem;
		}
		.leftA{
			text-align: left;
			font-family: sans-serif;
		}
		/*.login{
			align-items: center;
			margin-top: 5vh;
			background-color: #333;
			text-align: center;
			font-family: "ComicSansCustom", cursive;
		}*/
		.cardCont {
			display: flex;
			flex-direction: row;
			justify-content: center;
			align-items: center;
			height: calc(100% - 70px); /* adjust if navbar height changes */
			padding: 20px;
			margin-top: var(--v1);
			align-items: flex-start;
		}

			
		.card {
			background-color: var(--fg);
			padding: 40px 30px;
			margin: var(--v1);
			margin-top: 0px;
			border-radius: 16px;
			box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.85);
			width: 100%;
			text-align: center;
			font-family: "ComicSansCustom", cursive;
			outline: var(--dfg) solid 5px;
			align-items: center;
			transition: 0.5 cubic-bezier(0.755, 0.05, 0.855, 0.06);

		}
		.cardImg{
			width: 120px;
			height: 120px;
			border-radius: 16px;
			margin: 0 auto;
			margin-bottom: 20px;
			animation: rotation 2s infinite linear; 
			overflow: hidden;      
			position: relative;
			object-fit: cover;
			object-position: center center;
			outline: black solid 2px;
			box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.55);

		}
		.fortnitetextlol{
			display: inline-block;
			transform: rotate(-23deg) translateY(0.275vh);
			scale: 1.5;
			color:black;
		}
		.signindiv{
			width: 20%;
			display: flex;
			flex-direction: row;
			justify-content: center;
			align-items: center;
			margin: var(--v1);
		}
		.everythingints{
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}
		.btnmrgin{
			margin: var(--v1);
		}
		.regis{
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}
		.arrowimg{
			width: 11.913rem;
			height: auto;
			transform: translateY(0.745rem);
		}
		.arrleft{
			transform: scaleX(-1) translateY(0.745rem);
		}
		@keyframes rotation {
			0% {
				--gradient-angle: 0deg;
			}
			100% {
				--gradient-angle: 360deg;
			}
		}
	</style>
<link rel="stylesheet" href="gurtcss.css">
</head>
<body>
	<div class="zgori">
		<div id="logodiv">
			<h1 id="logo">Samotove Šolske Igrice</h1>
		</div>
		<a class="leftA"> Login</a>
		<button class="gumb" onclick="window.location.href = 'index.html';"style="margin-left: auto;">Nazaj</button>

	</div>
	<div class="everythingints">
	<div class="signindiv">
		<img src="arrow.png" alt="puščica tuki" class="arrowimg"></img>
		<div id="googlethingies">
			<div id="g_id_onload"
				data-client_id="449096486576-aaboh7qp5n83ko1rv4pb5k4iprq2vvc7.apps.googleusercontent.com"
				data-context="signin"
				data-ux_mode="popup"
				data-callback="handleCredentialResponse"
				data-auto_select="true"
				data-itp_support="true">
			</div>

			<div class="g_id_signin"
				data-type="standard"
				data-shape="rectangular"
				data-theme="outline"
				data-text="sign_in_with"
				data-size="large"
				data-logo_alignment="left">
			</div>
		</div>
		<div id="hepithingies" style="display: none;">
			<a> Hvala za se prijaviti!</a>
		</div>
		<img src="arrow.png" alt="puščica tuki" class="arrowimg arrleft"></img>
	</div>
	<div class="cardCont" id="cardcont">
		<div class="card" style="display: flex;flex-direction: column;justify-content: center;" id="login">
			<label>Prijavite se!</label>
			<button id="loginitems" class="gumb wip btnmrgin" onclick="loogin();">Prijava</button>
			<a id="logintip" style="color: var(--btn2);">Prijavite se z tistim google gumbom zgoraj!</a>
		</div>
		<div class="card" style="display: flex;flex-direction: column;justify-content: center;" id="register">
			<label>Registrirajte se!</label>
			<div id="regisitems" class="regis wip" >
				<a style="color: var(--btn5);font-style: italic;margin-bottom: var(--v1);">dajte si ime v tisto pod mano!</a>	
			    <input class="input" type="text" id="nameParam" maxlength="30" minlength="3"></input>
				<a style="color:#c11818;margin-bottom: var(--v1);display: none;" id="warnin">tole ime je že uporabljeno!</a>
			    <button class="gumb" style="background-color: #b04aea;" id="nameParamButton" onclick="dodatNameThing()">Izberite si ime!</button>
			</div>
			<div id="registext">
				
				<a id="registertip" style="color: var(--btn2);margin-top: 2.383rem;">Začnite registracijo z tistim google gumbom zgoraj!</a>
			</div>
		</div>
	</div>
	</div>
	<script>
		const cont =   document.getElementById("cardcont");
		cont.style.pointerEvents = "none"; // Onemogoči vsebino dokler se ne preveri prijava
		console.log(cont.style.pointerEvents);
		</script>
</body>
</html>