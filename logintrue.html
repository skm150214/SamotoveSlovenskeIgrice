<!DOCTYPE html>
<html lang="si">
<head>
	<meta charset="UTF-8">
	<title>Samotova Login AAAAAAAAAAAAAAAAA ƒçe to pozabim spremenit bo wololo</title>
	<script src="./logo.js" defer></script>
	<script src="https://accounts.google.com/gsi/client" async defer></script>
	<script>
data = null; // Global variable to store user data
function handleCredentialResponse(response) {
    const data = parseJwt(response.credential); // Raz≈°ifriraj Google token
  console.log("Logged in as:", data.name);
    document.getElementById("bouttalogindiv").style.display = "flex";
	document.getElementById("nameParamLabel").innerText = (data.name).slice(0, 30);
  // Shrani Google podatke v localStorage
  
  // Posodobi UI
  const loginBtn = document.querySelector('.g_id_signin');
  if (loginBtn) loginBtn.style.display = 'none';
}

function parseJwt(token) {
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  const jsonPayload = decodeURIComponent(
	atob(base64).split('').map(function (c) {
	  return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
	}).join('')
  );
  return JSON.parse(jsonPayload);
}
function checkProfanity(text) {
  const encodedText = encodeURIComponent(text);
  const url = `https://www.purgomalum.com/service/containsprofanity?text=${encodedText}`;

  try {
    const response = fetch(url);
    const result = esponse.text();

    if (result === "true") {
      return false;
    } else {
      return true;
    }
  } catch (error) {
    return -1;
  }
}
function checkIfNameExists(name1){

	fetch("https://samotovesi.si/check_name.php", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ name: name1 })
})
.then(res => res.json())
.then(data => {
  if (data.exists) {
    return false;
  } else {
    return true;
  }
})
.catch(err => console.error("Napaka:", err));
}
function dodatNameThing() {
  const isallatvalid = true;
  localStorage.setItem("name", document.getElementById("nameParam").value);
  if (!checkProfanity(localStorage.getItem("name"))) {
	alert("Ime vsebuje neprimerne besede. Poskusite z drugim imenom.");
	isallatvalid = false;
	return;
  }
  if(checkIfNameExists(localStorage.getItem("name"))){
	alert("To ime ≈æe obstaja. Izberite drugo ime.");
	isallatvalid = false;
	return;
  }
  if(isallatvalid){
  // Po≈°lji podatke na stre≈ænik ‚Äì z `sub` kot unikatni ID
  fetch('https://samotovesi.si/save_user.php', {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: localStorage.getItem("name"),
      sub: data.sub,            // üîê Kljuƒçna stvar: Google ID
      badges: []                // Zaƒçetni badge-i (lahko kasneje nadgradi≈°)
    })
  })
  .then(res => res.json())
  .then(result => {
    console.log("Rezultat prijave:", result);
    // Npr: shrani uid za uporabo naprej
    localStorage.setItem("uid", result.uid);
	window.location.href = "login.html"; // Preusmeri na glavno stran
  })
  .catch(err => console.error("Napaka:", err));
	}

}
// When page loads
document.addEventListener("DOMContentLoaded", () => {
    const user = localStorage.getItem("user");
    if (user) {
        window.location.href = "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
    }
});
</script>
	<style>
		@property --gradient-angle {
			syntax: "<angle>";
			initial-value: 0deg;
			inherits: false;
		}
		@font-face {
			font-family: "ComicSansBold";
			src: url("../../fonts/comicsans.ttf") format("truetype");
			font-weight: bold;
		}
			* {
	  margin: 0;
	  padding: 0;
	  box-sizing: border-box;
	}

		html {
			margin: 0;
			padding: 0;
			font-family: Arial, sans-serif;
		}
		body {
			background-color: lightslategray;
			background-size: 100% 100%;
			background-attachment: fixed;
			margin: 0;
			padding: 0;
			font-family: Arial, sans-serif;
		}

		.zgori {
			display:flex;
			justify-content:start;
			align-items: center;
			background-color: #333333;
			padding: 10px 20px;
			font-family: "ComicSansCustom", cursive;
			color: white;
		}
		.gumb{

			align-items: center;
			background-color: #4caf50;
			border: none;
			color: white;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			cursor: pointer;
			border-radius: 8px;
			font-family: "ComicSansCustom", cursive;
			transition: all 0.1s cubic-bezier(0.39, 0.575, 0.565, 1);
		}
		.gumb:hover{
			scale: 1.1;
			background-color: #2cad4e;
		}
		.input{
			cursor: pointer;
			border-radius: 8px;
			font-family: "ComicSansCustom", cursive;
			transition: all 0.1s cubic-bezier(0.39, 0.575, 0.565, 1);
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			padding: 15px 32px;
			margin-left: auto;
			align-items: right;
			background-color: #376d94;
			border: none;
			margin: 2vh;
			outline: black solid 0.5vh;
		}
		.leftA{
			text-align: left;
			font-family: sans-serif;
		}
		.login{
			align-items: center;
			margin-top: 5vh;
			background-color: #333;
			text-align: center;
			font-family: "ComicSansCustom", cursive;
			color: white;
		}
		.cardCont {
			display: grid;
			justify-content: center;
			align-items: center;
			height: calc(100% - 70px); /* adjust if navbar height changes */
			padding: 20px;
			margin-top: 1vh;
		}

			
		.card {
			background-color: #333; /* same as navbar */
			padding: 40px 30px;
			margin-bottom: 2vh;
			border-radius: 16px;
			box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.85);
			width: 100%;
			text-align: center;
			font-family: "ComicSansCustom", cursive;
			color: white;
			outline: beige solid 5px;
			align-items: center;
		}
		.Badcard {
			background-color: #333;
			padding: 40px 30px;
			margin-bottom: 2vh;
			border-radius: 16px;
			box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.85);
			width: 100%;
			height: 300px;

			font-family: "ComicSansCustom", cursive;
			color: white;
			outline: beige solid 5px;

			display: flex;
			flex-direction: column;
			justify-content: center;  /* center vertically */
			align-items: center;      /* center horizontally */
			text-align: center;
			margin: 0 auto; /* center the card itself on the page */
		}
		.cardImg{
			width: 120px;
			height: 120px;
			border-radius: 16px;
			margin: 0 auto;
			margin-bottom: 20px;
			animation: rotation 2s infinite linear; 
			overflow: hidden;      
			position: relative;
			object-fit: cover;
			object-position: center center;
			outline: black solid 2px;
			box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.55);
		}
		.fortnitetextlol{
			display: inline-block;
			transform: rotate(-23deg) translateY(0.275vh);
			scale: 1.5;
			color:black;
		}
		.wip{
			filter: grayscale(100%);
		}
		@keyframes rotation {
			0% {
				--gradient-angle: 0deg;
			}
			100% {
				--gradient-angle: 360deg;
			}
		}
	</style>

</head>
<body>
	<div class="zgori">
		<div id="logodiv">
			<h1 id="logo">Samotove ≈†olske Igrice</h1>
		</div>
		<a class="leftA"> Login</a>
		<button class="gumb" onclick="window.location.href = 'index.html';"style="margin-left: auto;">Nazaj</button>

	</div>
	<div class="cardCont">
		<div class="card">
			<label>Prijavite se via Google:</label>
				<div id="g_id_onload"
					data-client_id="449096486576-aaboh7qp5n83ko1rv4pb5k4iprq2vvc7.apps.googleusercontent.com"
					data-context="signin"
					data-ux_mode="popup"
					data-callback="handleCredentialResponse"
					data-auto_select="true"
					data-itp_support="true">
				</div>

				<div class="g_id_signin"
					data-type="standard"
					data-shape="rectangular"
					data-theme="outline"
					data-text="sign_in_with"
					data-size="large"
					data-logo_alignment="left">
				</div>
                <div id="bouttalogindiv" style="display: none;">
			        <label id="nameParamLabel" >Naredite si ime:</label>
			        <input class="input"type="text" id="nameParam" maxlength="30"></input>
			        <button class="gumb" style="background-color: #b04aea;" id="nameParamButton" onclick="dodatNameThing()">Izberite si ime!</button>
		        </div>
            </div>
	    </div>
    </body>
</html>